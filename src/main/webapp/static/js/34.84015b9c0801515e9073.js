webpackJsonp([34],{MdCm:function(e,t){},vom9:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),n=s.n(a),o=s("exGp"),i=s.n(o),r=s("//Fk"),c=s.n(r),l=s("mvHQ"),u=s.n(l),m=s("bOdI"),d=s.n(m),p={components:{loading:s("T4ej").a},data:function(){var e;return e={infomsg:"",requestmodel:!1,testlist:[],skyvalue:"",isshowsubclass:!1,modal3:!1,issubmit:!1,projectmodel:!1,isshow:!1,modal1:!1,ishownullmodel:"",opacity:""},d()(e,"opacity",1),d()(e,"inputsize",{minRows:6,maxRows:6}),d()(e,"visitdate",""),d()(e,"depname",""),d()(e,"position",""),d()(e,"form",{cardno:"",examsubclass:"",examclass:"",clindiag:"",performedby:"",patientsource:"1",reqdatetime:"",reqdept:"",reqphysician:"",doctoruser:"",descriptioncode:"",projectname:"",clinicno:"",visitno:""}),d()(e,"projectname",[]),d()(e,"checklist",[]),d()(e,"dealchecklist",[]),d()(e,"subchecklist",[]),d()(e,"dealsubchecklist",[]),d()(e,"projectnamelist",[]),d()(e,"dealprojectnamelist",[]),e},methods:{showmodel:function(){this.projectmodel=!0},inputLoseFocus:function(){setTimeout(function(){window.scrollTo(0,0)},100)},touchstart:function(){this.opacity=.5},touchend:function(){this.opacity=1},insertcheck:function(e){var t=this,s=u()(e),a=localStorage.getItem("yspatientinfo"),n=JSON.parse(a),o=n.name,i=this.form.examsubclass,r=n.openid,l=this,m=l.$store.getters.getUrl+"check/patientcheckup.do";return new c.a(function(e,a){var n=$.ajax({url:m,type:"post",dataType:"json",timeout:15e3,async:!0,data:{checkdata:s,visitdate:l.visitdate,username:o,items:i,openid:r,position:t.position},success:function(t){l.isshow=!1,"1"==t.status?(l.$Message.info("提交成功！"),e(),window.websocketobj.send(u()({cardno:l.form.cardno,massege:"123"}))):(l.modal1=!0,e())},error:function(e){l.isshow=!1,l.infomsg="请求发送失败",l.requestmodel=!0,a(e)},complete:function(e,t){"timeout"==t&&(n.abort(),l.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},tosubmit:function(){this.issubmit=!0},submit:function(){var e=this;return i()(n.a.mark(function t(){var s,a,o;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isshow=!0,0!=e.projectname.length){t.next=5;break}return e.isshow=!1,e.modal3=!0,t.abrupt("return");case 5:for(s=[],a=e.form,o=0;o<e.projectname.length;o++)a.descriptioncode=e.projectname[o].description_code,a.projectname=e.projectname[o].description,s.push({cardno:a.cardno,examsubclass:a.examsubclass,examclass:a.examclass,clindiag:a.clindiag,performedby:a.performedby,patientsource:"1",reqdatetime:a.reqdatetime,reqdept:a.reqdept,reqphysician:a.reqphysician,doctoruser:a.doctoruser,descriptioncode:a.descriptioncode,projectname:a.projectname,clinicno:a.clinicno,visitno:a.visitno});return t.next=10,e.insertcheck(s);case 10:e.init();case 11:case"end":return t.stop()}},t,e)}))()},deleteitem:function(e,t){for(var s=0;s<this.projectname.length;s++)this.projectname[s].description==e&&this.projectname.splice(t,1);this.dealprojectnamelist.splice(t,1)},changeproject:function(e){if(this.projectname=[],0!=e.length)for(var t=0;t<this.projectnamelist.length;t++)for(var s=0;s<e.length;s++)this.projectnamelist[t].description==e[s]&&this.projectname.push(this.projectnamelist[t])},changesubexamclass:function(e){var t=this;return i()(n.a.mark(function e(){var s,a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t,t.form.examclass,t.form.examsubclass,e.next=5,s.fetchprojectnamelist(s.form.examclass,s.form.examsubclass);case 5:"1"==(a=e.sent).status?(s.isshowsubclass=!0,s.projectnamelist=a.data):5==a.status?(s.infomsg="请求发送失败",s.requestmodel=!0):(s.infomsg="数据获取失败",s.requestmodel=!0);case 7:case"end":return e.stop()}},e,t)}))()},topath:function(){this.$router.push("/registeredlist")},fetchprojectnamelist:function(e,t){this.dealprojectnamelist=[],this.projectname=[];var s=this;return s.isshow=!0,new c.a(function(a,n){var o=s.$store.getters.getUrl+"check/getcheckthreeclass.do";$.ajax({url:o,type:"post",dataType:"json",async:!1,data:{examclassname:e,examsubclassname:t},success:function(e){s.isshow=!1,a(e)},error:function(e){s.isshow=!1;a({status:5})}})})},dealsubcheklist:function(e){var t=this;this.subchecklist=e;for(var s=[],a=0;a<e.length;a++){var n={value:e[a].exam_subclass_name,label:e[a].exam_subclass_name};s.push(n)}return t.dealsubchecklist=[],new c.a(function(e,a){t.dealsubchecklist=s,t.form.examsubclass=t.dealsubchecklist[0].value,e()})},fetchSubchecklit:function(e){var t=this;return t.isshow=!0,new c.a(function(s,a){var n=t.$store.getters.getUrl+"check/getsubclass.do",o=$.ajax({url:n,type:"post",dataType:"json",timeout:15e3,async:!0,data:{classname:e},success:function(e){t.isshow=!0,s(e)},error:function(e){t.isshow=!0,a(e)},complete:function(e,s){"timeout"==s&&(o.abort(),t.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},fetchdepname:function(e){var t=this;return new c.a(function(s,a){var n=t.$store.getters.getUrl+"check/getdeptname.do";$.ajax({url:n,type:"post",dataType:"json",async:!1,data:{deptcode:e},success:function(e){s(e.data[0])},error:function(e){a(e)}})})},changeexamclass:function(e){var t=this;return i()(n.a.mark(function s(){var a,o,i,r,c;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t.isshowsubclass=!1,e){s.next=3;break}return s.abrupt("return");case 3:for(a=t,o=0;o<t.checklist.length;o++)t.checklist[o].exam_class_name==e&&(t.form.performedby=t.checklist[o].perform_by);return s.next=7,a.fetchdepname(a.form.performedby);case 7:return i=s.sent,a.depname=i.dept_name,a.position=i.position,s.next=12,a.fetchSubchecklit(a.form.examclass);case 12:if(5!=(r=s.sent).status){s.next=17;break}return t.infomsg="请求发送失败",t.requestmodel=!0,s.abrupt("return");case 17:if("1"==r.status){s.next=21;break}return t.infomsg="数据请求失败",t.requestmodel=!0,s.abrupt("return");case 21:return s.next=23,a.dealsubcheklist(r.data);case 23:return s.next=25,a.fetchprojectnamelist(a.form.examclass,a.form.examsubclass);case 25:"1"==(c=s.sent).status?(a.isshowsubclass=!0,a.projectnamelist=c.data):5==c.status?(a.infomsg="请求发送失败",a.requestmodel=!0):(a.infomsg="数据获取失败",a.requestmodel=!0);case 27:case"end":return s.stop()}},s,t)}))()},dealcheckresult:function(e){this.dealchecklist=[];for(var t=[],s=0;s<e.length;s++){var a={value:e[s].exam_class_name,label:e[s].exam_class_name};t.push(a)}return t},fetchecklist:function(){var e=this;return new c.a(function(t,s){var a=e.$store.getters.getUrl+"check/getcheckclass.do",n=$.ajax({url:a,type:"post",dataType:"json",timeout:15e3,async:!0,data:"",success:function(e){t(e)},error:function(e){t({status:5})},complete:function(t,s){"timeout"==s&&(n.abort(),e.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},fetchclindiag:function(){var e=this,t=new Date,s=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();a<10&&(a="0"+a),n<10&&(n="0"+n);var o=s+"-"+a+"-"+n;return new c.a(function(t,s){var a=e.$store.getters.getUrl+"check/getOutpMrDiagDesc.do";e.isshow=!0;var n=$.ajax({url:a,type:"post",dataType:"json",timeout:15e3,async:!0,data:{cardno:e.form.cardno,visitdate:o,doctorno:e.form.doctoruser},success:function(s){e.isshow=!1,t(s)},error:function(s){e.isshow=!1;t({status:5})},complete:function(t,s){"timeout"==s&&(n.abort(),e.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},init:function(){var e=this;return i()(n.a.mark(function t(){var s,a,o,i,r,c,l,u,m,d;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.visitdate="",e.depname="",e.form.cardno="",e.form.examsubclass="",e.form.examclass="",e.form.clindiag="",e.form.performedby="",e.form.patientsource="1",e.form.reqdatetime="",e.form.reqdept="",e.form.reqphysician="",e.form.doctoruser="",e.form.descriptioncode="",e.form.projectname="",e.form.clinicno="",e.form.visitno="",e.projectname=[],e.checklist=[],e.dealchecklist=[],e.subchecklist=[],e.dealsubchecklist=[],e.projectnamelist=[],e.dealprojectnamelist=[],s=localStorage.getItem("yspatientinfo"),a=JSON.parse(s),e.form.reqphysician=a.hosdocname,e.form.doctoruser=a.doctor,e.form.reqdept=a.registerdept,e.form.cardno=a.patientid,e.form.clinicno=a.clinicno,e.form.visitno=a.visitno,o=new Date,i=o.getFullYear(),r=o.getMonth()+1,c=o.getDate(),r<10&&(r="0"+r),c<10&&(c="0"+c),e.visitdate=i+"-"+r+"-"+c,e.form.reqdatetime=i+"-"+r+"-"+c,l=e,t.next=29,l.fetchclindiag();case 29:if("1"==(u=t.sent).status){t.next=34;break}return l.infomsg="获取数据失败",l.requestmodel=!0,t.abrupt("return");case 34:return l.form.clindiag=u.data[0].diagdesc,t.next=37,l.fetchecklist();case 37:if("1"==(m=t.sent).status){t.next=42;break}return l.infomsg="获取数据失败",l.requestmodel=!0,t.abrupt("return");case 42:l.checklist=m.data,d=l.dealcheckresult(m.data),l.dealchecklist=d,l.isshow=!1;case 46:case"end":return t.stop()}},t,e)}))()}},mounted:function(){var e=this;this.isshow=!0,setTimeout(function(){e.init()},10)}},f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"writecheck-page"},[s("div",{staticClass:"content"},[s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                临床诊断:\n            ")]),e._v(" "),s("Input",{staticClass:"input-item",attrs:{disabled:""},on:{"on-blur":function(t){return t.preventDefault(),e.inputLoseFocus(t)}},model:{value:e.form.clindiag,callback:function(t){e.$set(e.form,"clindiag",t)},expression:"form.clindiag"}})],1),e._v(" "),s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                检查类别:\n            ")]),e._v(" "),s("Select",{on:{"on-change":e.changeexamclass},model:{value:e.form.examclass,callback:function(t){e.$set(e.form,"examclass",t)},expression:"form.examclass"}},e._l(e.dealchecklist,function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),e.isshowsubclass?s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                检查子类:\n            ")]),e._v(" "),s("Select",{attrs:{clearable:""},on:{"on-change":e.changesubexamclass},model:{value:e.form.examsubclass,callback:function(t){e.$set(e.form,"examsubclass",t)},expression:"form.examsubclass"}},e._l(e.dealsubchecklist,function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1):e._e(),e._v(" "),e.isshowsubclass?e._e():s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                检查子类:\n            ")]),e._v(" "),s("Select",{attrs:{clearable:""},model:{value:e.skyvalue,callback:function(t){e.skyvalue=t},expression:"skyvalue"}},e._l(e.testlist,function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                执行科室:\n            ")]),e._v(" "),s("Input",{staticClass:"input-item",attrs:{disabled:""},on:{"on-blur":function(t){return t.preventDefault(),e.inputLoseFocus(t)}},model:{value:e.depname,callback:function(t){e.depname=t},expression:"depname"}})],1),e._v(" "),s("div",{staticClass:"item-wrapper"},[s("div",{staticClass:"title-tip"},[e._v("\n                申请医生:\n            ")]),e._v(" "),s("Input",{staticClass:"input-item",attrs:{disabled:""},on:{"on-blur":function(t){return t.preventDefault(),e.inputLoseFocus(t)}},model:{value:e.form.reqphysician,callback:function(t){e.$set(e.form,"reqphysician",t)},expression:"form.reqphysician"}})],1),e._v(" "),e.form.examsubclass?s("div",{staticClass:"add-btn",on:{click:e.showmodel}},[e._v("\n            添加项目\n        ")]):e._e(),e._v(" "),e._l(e.projectname,function(t,a){return s("div",{key:a,staticClass:"input-wrapper"},[e._v("\n            "+e._s(t.description)),s("div",{on:{click:function(s){return e.deleteitem(t.description,a)}}},[e._v("删除")])])})],2),e._v(" "),s("div",[s("div",{staticClass:"primarybtn",style:{opacity:e.opacity},attrs:{long:""},on:{touchstart:e.touchstart,touchend:e.touchend,click:e.tosubmit}},[e._v("提交")])]),e._v(" "),s("Modal",{attrs:{title:"提示"},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[e._v("\n        提交失败\n    ")]),e._v(" "),s("Modal",{attrs:{title:"提示"},model:{value:e.modal3,callback:function(t){e.modal3=t},expression:"modal3"}},[e._v("\n        信息不全禁止提交\n    ")]),e._v(" "),s("Modal",{attrs:{title:"提示"},on:{"on-ok":e.submit},model:{value:e.issubmit,callback:function(t){e.issubmit=t},expression:"issubmit"}},[e._v("\n        请确认是否提交\n    ")]),e._v(" "),s("Modal",{attrs:{fullscreen:"",title:"检查项目"},model:{value:e.projectmodel,callback:function(t){e.projectmodel=t},expression:"projectmodel"}},[s("CheckboxGroup",{attrs:{size:"large"},on:{"on-change":e.changeproject},model:{value:e.dealprojectnamelist,callback:function(t){e.dealprojectnamelist=t},expression:"dealprojectnamelist"}},e._l(e.projectnamelist,function(e,t){return s("Checkbox",{key:t,staticClass:"Checkbox",attrs:{size:"large",label:e.description}})}),1)],1),e._v(" "),s("Modal",{attrs:{title:"提示"},model:{value:e.requestmodel,callback:function(t){e.requestmodel=t},expression:"requestmodel"}},[e._v("\n        "+e._s(e.infomsg)+"\n    ")]),e._v(" "),s("loading",{directives:[{name:"show",rawName:"v-show",value:e.isshow,expression:"isshow"}]})],1)},staticRenderFns:[]};var h=s("VU/8")(p,f,!1,function(e){s("MdCm")},"data-v-7c972881",null);t.default=h.exports}});