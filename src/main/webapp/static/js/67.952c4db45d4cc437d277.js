webpackJsonp([67],{"8pTZ":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Xxa5"),n=a.n(s),o=a("exGp"),i=a.n(o),r=a("mvHQ"),c=a.n(r),l=a("//Fk"),m=a.n(l),u={components:{loading:a("T4ej").a},data:function(){return{requestmodel:!1,infomsg:"",modal3:!1,issubmit:!1,projectmodel:!1,isshow:!1,modal1:!1,inputsize:{minRows:6,maxRows:6},opacity:1,depname:"检验科",position:"二楼东侧",form:{examclass:"",patientid:"",performedby:"",sysdate:"",visitdate:"",reqdept:"",reqphysician:"",doctorno:"",itemcode:"",itemname:"",chargetype:"",clinicno:"",visitno:""},projectname:[],checklist:[],dealchecklist:[],projectnamelist:[],dealprojectnamelist:[]}},methods:{tosubmit:function(){this.issubmit=!0},showmodel:function(){this.projectmodel=!0},inputLoseFocus:function(){setTimeout(function(){window.scrollTo(0,0)},100)},topath:function(){this.$router.push("/registeredlist")},touchstart:function(){this.opacity=.5},touchend:function(){this.opacity=1},insertPatientAssay:function(e){var t=new Date,a=t.getFullYear(),s=t.getMonth()+1,n=t.getDate();s<10&&(s="0"+s),n<10&&(n="0"+n);var o=a+"-"+s+"-"+n,i=this.depname,r=this.form.examclass,l=localStorage.getItem("yspatientinfo"),u=JSON.parse(l),p=u.name,d=u.openid,f=this,h=f.$store.getters.getUrl+"chemicalexam/insertPatientAssay.do";return new m.a(function(t,a){var s=$.ajax({url:h,type:"post",dataType:"json",timeout:15e3,async:!0,data:{assaydata:c()(e),visitdate:o,subclass:i,items:r,openid:d,username:p,position:f.position},success:function(e){f.isshow=!1,t(e.status)},error:function(e){f.isshow=!1,t(e)},complete:function(e,t){"timeout"==t&&(s.abort(),f.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},submit:function(){var e=this;return i()(n.a.mark(function t(){var a,s,o,i,r,l;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isshow=!0,a=e,0!=e.projectname.length){t.next=6;break}return e.isshow=!1,e.modal3=!0,t.abrupt("return");case 6:for(s=[],o=0;o<e.projectname.length;o++){for(r in i={},e.form)i[r]=e.form[r];i.itemcode=e.projectname[o].item_code,i.itemname=e.projectname[o].item_name,i.specimen=e.projectname[o].expand1,s.push(i)}return t.next=10,e.insertPatientAssay(s);case 10:l=t.sent,a.isshow=!1,"1"==l?(a.$Message.info("提交成功！"),window.websocketobj.send(c()({cardno:a.form.patientid,massege:"123"})),a.init()):a.modal1=!0;case 13:case"end":return t.stop()}},t,e)}))()},changeproject:function(e){if(this.projectname=[],0!=e.length)for(var t=0;t<this.projectnamelist.length;t++)for(var a=0;a<e.length;a++)this.projectnamelist[t].item_name==e[a]&&this.projectname.push(this.projectnamelist[t])},_fetchprojectnamelist:function(e,t){var a=this;return new m.a(function(s,n){a.isshow=!0;var o=a.$store.getters.getUrl+"chemicalexam/getassaysecondclass.do";$.ajax({url:o,type:"post",dataType:"json",async:!1,data:{expand3:e,expand2:t},success:function(e){a.isshow=!1,s(e)},error:function(e){a.isshow=!1;s({status:5})}})})},deleteitem:function(e,t){for(var a=0;a<this.projectname.length;a++)this.projectname[a].item_name==e&&this.projectname.splice(t,1);this.dealprojectnamelist.splice(t,1)},changeexamclass:function(e){var t=this;return i()(n.a.mark(function a(){var s,o,i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:for((s=t).dealprojectnamelist=[],s.projectname=[],o=0;o<t.checklist.length;o++)t.checklist[o].class_name==e&&(t.form.examclass=t.checklist[o].class_name,t.form.performedby=t.checklist[o].dept_code);return a.next=8,s._fetchprojectnamelist(t.form.performedby,t.form.examclass);case 8:"1"==(i=a.sent).status?s.projectnamelist=i.data:5==i.status?(s.infomsg="请求发送失败",s.requestmodel=!0):(s.infomsg="获取数据失败",s.requestmodel=!0);case 10:case"end":return a.stop()}},a,t)}))()},_dealchemicalexamlist:function(e){this.checklist=e;for(var t=[],a=0;a<e.length;a++)if(e[a].class_name){var s={value:e[a].class_name,label:e[a].class_name};t.push(s)}return t},_fetchchemicalexamlist:function(){var e=this;return new m.a(function(t,a){var s=e;s.isshow=!0;var n=s.$store.getters.getUrl+"chemicalexam/getassayclass.do",o=$.ajax({url:n,type:"post",dataType:"json",timeout:15e3,async:!0,data:"",success:function(e){s.isshow=!1,t(e)},error:function(e){s.isshow=!1;t({status:5})},complete:function(e,t){"timeout"==t&&(o.abort(),s.$Modal.warning({title:"友情提示",content:"请求超时"}))}})})},init:function(){var e=this;return i()(n.a.mark(function t(){var a,s,o,i,r,c,l;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.form.patientid="",e.form.performedby="",e.form.sysdate="",e.form.visitdate="",e.form.reqdept="",e.form.reqphysician="",e.form.doctorno="",e.form.itemcode="",e.form.itemname="",e.depname="检验科",e.form.examclass="",e.form.chargetype="",e.form.clinicno="",e.form.visitno="",e.projectname=[],e.checklist=[],e.dealchecklist=[],e.projectnamelist=[],e.dealprojectnamelist=[],t.next=4,e._fetchchemicalexamlist();case 4:if(5!=(a=t.sent).status){t.next=9;break}return e.infomsg="请求发送失败",e.requestmodel=!0,t.abrupt("return");case 9:if("1"==a.status){t.next=13;break}return e.infomsg="获取数据失败",e.requestmodel=!0,t.abrupt("return");case 13:e.dealchecklist=e._dealchemicalexamlist(a.data),s=localStorage.getItem("yspatientinfo"),o=JSON.parse(s),e.form.reqphysician=o.hosdocname,e.form.doctorno=o.doctor,e.form.reqdept=o.registerdept,e.form.patientid=o.patientid,e.form.clinicno=o.clinicno,e.form.visitno=o.visitno,i=new Date,r=i.getFullYear(),c=i.getMonth()+1,l=i.getDate(),e.form.sysdate=r+"-"+c+"-"+l,c<10&&(c="0"+c),l<10&&(l="0"+l),e.form.visitdate=r+"-"+c+"-"+l;case 30:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.init()}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"writecheck-page"},[a("div",{staticClass:"content"},[a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"title-tip"},[e._v("\n                化验类别:\n            ")]),e._v(" "),a("Select",{attrs:{placeholder:""},on:{"on-change":e.changeexamclass},model:{value:e.form.examclass,callback:function(t){e.$set(e.form,"examclass",t)},expression:"form.examclass"}},e._l(e.dealchecklist,function(t,s){return a("Option",{key:s,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"title-tip"},[e._v("\n                执行科室:\n            ")]),e._v(" "),a("Input",{staticClass:"input-item",attrs:{disabled:""},on:{"on-blur":function(t){return t.preventDefault(),e.inputLoseFocus(t)}},model:{value:e.depname,callback:function(t){e.depname=t},expression:"depname"}})],1),e._v(" "),a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"title-tip"},[e._v("\n                申请医生:\n            ")]),e._v(" "),a("Input",{staticClass:"input-item",attrs:{disabled:""},on:{"on-blur":function(t){return t.preventDefault(),e.inputLoseFocus(t)}},model:{value:e.form.reqphysician,callback:function(t){e.$set(e.form,"reqphysician",t)},expression:"form.reqphysician"}})],1),e._v(" "),e.form.examclass?a("div",{staticClass:"add-btn",on:{click:e.showmodel}},[e._v("\n            添加项目\n        ")]):e._e(),e._v(" "),e._l(e.projectname,function(t,s){return a("div",{key:s,staticClass:"input-wrapper"},[e._v("\n            "+e._s(t.item_name)),a("div",{on:{click:function(a){return e.deleteitem(t.item_name,s)}}},[e._v("删除")])])})],2),e._v(" "),a("div",[a("div",{staticClass:"primarybtn",style:{opacity:e.opacity},on:{touchstart:e.touchstart,touchend:e.touchend,click:e.tosubmit}},[e._v("提交")])]),e._v(" "),a("Modal",{attrs:{title:"提示"},model:{value:e.requestmodel,callback:function(t){e.requestmodel=t},expression:"requestmodel"}},[a("p",[e._v(e._s(e.infomsg))])]),e._v(" "),a("Modal",{attrs:{title:"提示"},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[a("p",[e._v("开化验失败")])]),e._v(" "),a("Modal",{attrs:{title:"提示"},on:{"on-ok":e.submit},model:{value:e.issubmit,callback:function(t){e.issubmit=t},expression:"issubmit"}},[e._v("\n        请确认是否提交\n    ")]),e._v(" "),a("Modal",{attrs:{title:"提示"},model:{value:e.modal3,callback:function(t){e.modal3=t},expression:"modal3"}},[a("p",[e._v("内容不全禁止提交")])]),e._v(" "),a("Modal",{attrs:{fullscreen:"",title:"化验项目"},model:{value:e.projectmodel,callback:function(t){e.projectmodel=t},expression:"projectmodel"}},[a("CheckboxGroup",{attrs:{size:"large"},on:{"on-change":e.changeproject},model:{value:e.dealprojectnamelist,callback:function(t){e.dealprojectnamelist=t},expression:"dealprojectnamelist"}},e._l(e.projectnamelist,function(e,t){return a("Checkbox",{key:t,staticClass:"Checkbox",attrs:{size:"large",label:e.item_name}})}),1)],1),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.isshow,expression:"isshow"}]})],1)},staticRenderFns:[]};var d=a("VU/8")(u,p,!1,function(e){a("sS1n")},"data-v-2da352bc",null);t.default=d.exports},sS1n:function(e,t){}});