webpackJsonp([75],{"0kI5":function(t,e){},Gg9O:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),n=s.n(i),r={components:{loading:s("T4ej").a},data:function(){return{unselectdrugmodel:!1,isfetchdrugs:!1,isinsertprescribe:!1,styleindex:-1,isshowtip:!1,deldrugindex:0,currentdrugindex:0,isshowall:!1,isshowdrugs:!1,opacity:1,timestate:!1,isshowloading:!1,searchdrugs:[],channel:[],frequency:[],searchdrugmodal:!1,drugName:"",searchdruglist:[],form:{name:"",cardno:"",visitno:"",clinicno:"",orderby:"",depname:"",docname:"",doccode:"",sumcharges:"",itemclass:"A",orderclass:"A",openid:"",starttime:"",nizhen:"",outs:[]}}},mounted:function(){var t=this;setTimeout(function(){t.initdata(),t.init()},10)},methods:{inputLoseFocus:function(){setTimeout(function(){window.scrollTo(0,0)},100)},topath:function(){this.$router.push("/examination")},init:function(){var t=this;setTimeout(function(){t.getcurrentdayrecord(),t.searchDrug(t.form.orderclass),t.getpatientinfo(),t.fetchchannel(),t.fetchfrequency()},10)},initdata:function(){this.unselectdrugmodel=!1,this.isfetchdrugs=!1,this.isinsertprescribe=!1,this.styleindex=-1,this.isshowtip=!1,this.deldrugindex=0,this.currentdrugindex=0,this.isshowall=!1,this.isshowdrugs=!1,this.opacity=1,this.timestate=!1,this.isshowloading=!1,this.searchdrugs=[],this.channel=[],this.frequency=[],this.searchdrugmodal=!1,this.drugName="",this.searchdruglist=[],this.form.name="",this.form.cardno="",this.form.visitno="",this.form.clinicno="",this.form.orderby="",this.form.depname="",this.form.docname="",this.form.doccode="",this.form.sumcharges="",this.form.openid="",this.form.starttime="",this.form.nizhen="",this.form.outs=[]},getcurrentdayrecord:function(){var t=this,e=JSON.parse(localStorage.getItem("yspatientinfo")),s=e.patientid,i=e.visitno,n=new Date,r=n.getFullYear(),a=n.getMonth()+1,o=n.getDate();a<10&&(a="0"+a),o<10&&(o="0"+o);var c=r+"-"+a+"-"+o,u=e.doctor,l=t.$store.getters.getUrl+"medicalrecord/getthesamedayoutpmr.do";t.isshowloading=!0;var d=$.ajax({url:l,type:"post",dataType:"json",async:!0,timeout:15e3,data:{patientid:s,visitdate:c,doccode:u,visitno:i},success:function(e){t.isshowloading=!1,1==e.status?t.form.nizhen=e.data[0].diagdesc:(t.requestmodel=!0,t.infomsg="获取数据失败")},error:function(e){t.isshowloading=!1,t.requestmodel=!0,t.infomsg="请求发送失败"},complete:function(e,s){"timeout"==s&&(d.abort(),t.$Modal.warning({title:"友情提示",content:"请求超时"}))}})},showdrugmodal:function(){this.searchdrugmodal=!0,this.isfetchdrugs||(this.isshowloading=!0)},dealsearchDrug:function(){var t=this.drugName.toUpperCase(),e=this.searchdrugs;if(this.searchdruglist=[],""!==this.drugName)for(var s=0;s<e.length;s++)if(e[s].hasOwnProperty("ypname")&&"0"!=e[s].inventory){var i=e[s].ypname.toString(),n=e[s].inputcode.toString();(i.includes(t)||n.includes(t))&&this.searchdruglist.push(e[s])}},searchDrug:function(t){var e=this,s="";s="A"==t?e.$store.getters.getUrl+"prescription/westernmedicine.do":e.$store.getters.getUrl+"prescription/chinesemedicine.do";var i=$.ajax({url:s,type:"post",dataType:"json",async:!0,timeout:15e3,data:"",success:function(t){if(e.isshowloading=!1,e.isfetchdrugs=!0,"1"==t.status){for(var s=[],i=0;i<t.data.length;i++)"0"!==t.data[i].inventory&&s.push(t.data[i]);e.searchdrugs=s}else"0"==t.status?(e.requestmodel=!0,e.infomsg="暂无数据"):(e.requestmodel=!0,e.infomsg="系统异常")},error:function(t){e.isshowloading=!1,e.requestmodel=!0,e.infomsg="系统异常"},complete:function(t,s){"timeout"==s&&(i.abort(),e.$Modal.warning({title:"友情提示",content:"请求超时"}))}})},getpatientinfo:function(){var t=localStorage.getItem("yspatientinfo"),e=JSON.parse(t);this.form.name=e.name,this.form.cardno=e.patientid,this.form.orderby=e.registerdept,this.form.depname=e.hosdepname,this.form.docname=e.hosdocname,this.form.doccode=e.doctor,this.form.openid=e.openid,this.form.starttime=e.starttime,this.form.visitno=e.visitno,this.form.clinicno=e.clinicno},dealfetchchannel:function(t){this.channel=[];for(var e=0;e<t.length;e++)this.channel.push({value:t[e].pcusename,label:t[e].pcusename})},fetchchannel:function(){var t=this,e=t.$store.getters.getUrl+"prescription/channel.do",s=$.ajax({url:e,type:"post",dataType:"json",timeout:15e3,async:!0,data:"",success:function(e){t.dealfetchchannel(e.data)},error:function(t){},complete:function(e,i){"timeout"==i&&(s.abort(),t.$Modal.warning({title:"友情提示",content:"请求超时"}))}})},dealfetchfrequency:function(t){this.frequency=[{value:"一日一次",label:"一日一次"},{value:"一日二次",label:"一日二次"},{value:"一日三次",label:"一日三次"},{value:"一日四次",label:"一日四次"},{value:"一日五次",label:"一日五次"},{value:"一日六次",label:"一日六次"}]},fetchfrequency:function(){var t=this,e=t.$store.getters.getUrl+"prescription/frequency.do",s=$.ajax({url:e,type:"post",dataType:"json",timeout:15e3,async:!0,data:"",success:function(e){t.dealfetchfrequency(e.data)},error:function(t){},complete:function(e,i){"timeout"==i&&(s.abort(),t.$Modal.warning({title:"友情提示",content:"请求超时"}))}})},editdrugdetail:function(t){this.styleindex=-1,"-1"==t?this.isshowall=!0:(this.isshowall=!1,this.currentdrugindex=t),this.isshowdrugs=!0},touchstart:function(){this.opacity=.5},touchend:function(){this.opacity=1},changefrequency:function(t){this.sumprice(t)},sumprice:function(t){if(t.amount&&t.dosAge&&t.frequency){var e=parseFloat(t.amount),s=t.price.toString().split("."),i=s[1].length,n=0;if(0==s[0]){var r=t.price*Math.pow(10,i);n=parseInt(r)}else n=t.price*Math.pow(10,i);t.charges=e*n/Math.pow(10,i),t.costs=e*n/Math.pow(10,i);var a=void 0;"一日一次"==t.frequency?a=1:"一日二次"==t.frequency?a=2:"一日三次"==t.frequency?a=3:"一日四次"==t.frequency?a=4:"一日五次"==t.frequency?a=5:"一日六次"==t.frequency&&(a=6);var o,c=void 0,u=void 0;if("盒"==t.units){var l=t.drugSpec.split("*");c=e*parseInt(l[1]),u=Math.ceil(t.dosAge)*a}else c=e,u=Math.ceil(t.dosAge)*a;o=Math.ceil(c/u),t.abidance=o;for(var d=this.form.outs,m=0,f=0;f<d.length;f++){m+=parseInt(100*d[f].charges)/100}this.form.sumcharges=m}},isdeletitem:function(t){this.deldrugindex=t,this.isshowtip=!0},deletoutsitem:function(){this.form.outs.splice(this.deldrugindex,1);for(var t=this.form.outs,e=0,s=0;s<t.length;s++)e+=parseInt(100*t[s].charges)/100;this.form.sumcharges=e},fetchfirmid:function(t,e){var s=void 0,i=this,n=i.$store.getters.getUrl+"";return i.isshowloading=!0,$.ajax({url:n,type:"post",dataType:"json",async:!1,data:{itemcode:e,itemspec:t},success:function(t){i.isshowloading=!1,s=t},error:function(t){i.isshowloading=!1,s={status:5}}}),s},adddrug:function(t){var e=this;e.searchdrugmodal=!1,e.isshowall=!1,setTimeout(function(){for(var s=!0,i=0;i<e.form.outs.length;i++)e.form.outs[i].drugName==t.ypname&&(s=!1);if(s)if("A"==e.form.orderclass&&e.form.outs.length>=5)e.$Message.info("西药只能开五种药品！");else{var n={drugCode:"",drugName:"",drugSpec:"",firmId:"",units:"",dispensary:"",dispensarySub:"",price:"",amount:null,abidance:"",dosAge:"",dosAgeUnits:"",administretion:"",frequency:"",charges:0,costs:0,orderNo:"1",subOrderNo:"1",freqDetail:"医嘱说明",repetition:1};n.drugCode=t.ypcode,n.drugName=t.ypname,n.drugSpec=t.drugspec,n.units=t.unit,n.dispensary=t.storagecode,n.dispensarySub=t.substorage;var r=t.drugspec,a=t.ypcode,o=e.fetchfirmid(r,a);"0"==o.status?(e.requestmodel=!0,e.infomsg="暂无数据"):"1"==o.status?(n.firmId=o.data[0].firm_id,n.drugSpec=o.data[0].drug_spec+o.data[0].drug_supplier_id):"-1"==o.status?(e.requestmodel=!0,e.infomsg="系统异常查询药库失败"):(e.requestmodel=!0,e.infomsg="请求发送失败"),0===t.ypprice.toString().indexOf(".")?n.price="0"+t.ypprice:n.price=t.ypprice,t.unit,n.dosAgeUnits=t.unit,e.form.outs.push(n);var c=e.form.outs;e.isshowdrugs=!0,e.form.outs=[],setTimeout(function(){e.form.outs=c,e.currentdrugindex=c.length-1},10)}else if(!e.timestate){e.timestate=!0,e.$Message.warning({content:"该药品已选择，请选择其他药品！",duration:1});var u=setInterval(function(){e.timestate=!1,clearInterval(u)},1100)}},10)},toinsertprescribe:function(){this.isinsertprescribe=!0},checkouts:function(t){for(var e=!1,s=0;s<t.length;s++)for(var i in t[s]){if(""===t[s][i])return this.styleindex=s,this.$Message.warning("请把信息填写完整！"),e=!1,!1;e=!0}return e},insertprescribe:function(){var t=this;if(0!=t.form.outs.length){if(t.checkouts(t.form.outs)){var e=n()(t.form.outs),s={};s.outss=e,s.name=t.form.name,s.cardno=t.form.cardno,s.clinicno=t.form.clinicno,s.visitno=t.form.visitno,s.orderby=t.form.orderby,s.doctor=t.form.docname,s.doctorno=t.form.doccode,s.sumcharges=t.form.sumcharges,s.itemclass=t.form.itemclass,s.orderclass=t.form.orderclass,s.depname=t.form.depname,s.nizhen=t.form.nizhen;var i=t.$store.getters.getUrl+"prescription/prescribe.do?openid="+t.form.openid+"&starttime="+t.form.starttime;t.isshowloading=!0;var r=$.ajax({url:i,type:"post",dataType:"json",timeout:15e3,async:!0,contentType:"application/json",data:n()(s),success:function(e){t.isshowloading=!1,"1"===e.status?(t.$Message.info("开方成功"),t.initdata(),t.getcurrentdayrecord(),window.websocketobj.send(n()({cardno:t.form.cardno,massege:"123"})),t.init()):t.$Message.error("开方失败")},error:function(e){t.isshowloading=!1,t.$Message.error("请求失败")},complete:function(e,s){"timeout"==s&&(r.abort(),t.$Modal.warning({title:"友情提示",content:"请求超时"}))}})}}else this.unselectdrugmodel=!0}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"prescription-page"},[s("div",{staticClass:"content",attrs:{id:"content"}},[s("div",{staticClass:"item-wrapper"},[t._m(0),t._v(" "),s("Input",{attrs:{disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),s("div",{staticClass:"item-wrapper"},[t._m(1),t._v(" "),s("Input",{attrs:{disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.form.cardno,callback:function(e){t.$set(t.form,"cardno",e)},expression:"form.cardno"}})],1),t._v(" "),s("div",{staticClass:"item-wrapper"},[t._m(2),t._v(" "),s("Input",{attrs:{disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.form.depname,callback:function(e){t.$set(t.form,"depname",e)},expression:"form.depname"}})],1),t._v(" "),s("div",{staticClass:"item-wrapper"},[t._m(3),t._v(" "),s("Input",{attrs:{disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.form.docname,callback:function(e){t.$set(t.form,"docname",e)},expression:"form.docname"}})],1),t._v(" "),s("div",{staticClass:"item-wrapper"},[t._m(4),t._v(" "),s("Input",{attrs:{disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.form.orderclass,callback:function(e){t.$set(t.form,"orderclass",e)},expression:"form.orderclass"}})],1),t._v(" "),s("div",{staticClass:"drug"},[s("div",{staticClass:"add-btn",on:{click:t.showdrugmodal}},[t._v("\n                请添加药品\n            ")]),t._v(" "),void 0==t.form.outs||t.form.outs.length<=0?s("div",{staticClass:"drug-tip"},[s("div",[t._v("\n                    请添加药品\n                ")])]):t._e(),t._v(" "),void 0!==t.form.outs&&t.form.outs.length>0?s("div",[s("div",{staticClass:"add-btn",on:{click:function(e){return t.editdrugdetail(-1)}}},[t._v("\n                    查看全部药品\n                ")]),t._v(" "),t._l(t.form.outs,function(e,i){return s("div",{key:i,staticClass:"item-wrapper",class:{active:t.styleindex==i}},[s("div",{staticClass:"drugname"},[t._v("\n                        "+t._s(e.drugName)+"  \n                    ")]),t._v(" "),s("div",{staticClass:"detaile",on:{click:function(e){return t.editdrugdetail(i)}}},[t._v("\n                        详情\n                    ")]),t._v(" "),s("div",{staticClass:"detaile",on:{click:function(e){return t.isdeletitem(i)}}},[t._v("\n                        删除\n                    ")])])})],2):t._e()])]),t._v(" "),s("div",[s("div",{staticClass:"primarybtn",style:{opacity:t.opacity},on:{touchstart:t.touchstart,touchend:t.touchend,click:t.toinsertprescribe}},[t._v("提交")])]),t._v(" "),s("Modal",{attrs:{fullscreen:"",title:"药品详情"},model:{value:t.isshowdrugs,callback:function(e){t.isshowdrugs=e},expression:"isshowdrugs"}},[s("div",{staticClass:"collapse-box"},t._l(t.form.outs,function(e,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentdrugindex==i||t.isshowall,expression:"currentdrugindex==index||isshowall"}],key:i},[s("div",{staticClass:"drug-item",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"drugName"},[t._v(t._s(e.drugName)+"\n                    ")]),t._v(" "),s("div",{staticClass:"drugSpec"},[t._v("规格："+t._s(e.drugSpec))]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[t._v("\n                                每次用量：\n                            ")]),t._v(" "),s("Input",{attrs:{type:"number"},on:{"on-change":function(s){return t.sumprice(e)},"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:e.dosAge,callback:function(s){t.$set(e,"dosAge",s)},expression:"item.dosAge"}}),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                "+t._s("盒"==e.dosAgeUnits?"":e.dosAgeUnits)+"\n                            ")])],1)]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[t._v("\n                                用法：\n                            ")]),t._v(" "),s("Select",{attrs:{"label-in-value":""},model:{value:e.administretion,callback:function(s){t.$set(e,"administretion",s)},expression:"item.administretion"}},t._l(t.channel,function(e){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                "+t._s("")+"\n                            ")])],1)]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[s("span",[t._v("\n                                    频次：\n                                ")])]),t._v(" "),s("Select",{attrs:{"label-in-value":""},on:{"on-change":function(s){return t.changefrequency(e)}},model:{value:e.frequency,callback:function(s){t.$set(e,"frequency",s)},expression:"item.frequency"}},t._l(t.frequency,function(e){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                "+t._s("")+"\n                            ")])],1)]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[t._v("\n                                数量：\n                            ")]),t._v(" "),s("Input",{attrs:{type:"number"},on:{"on-change":function(s){return t.sumprice(e)},"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:e.amount,callback:function(s){t.$set(e,"amount",s)},expression:"item.amount"}}),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                "+t._s(e.units)+"\n                            ")])],1)]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[t._v("\n                                用药天数：\n                            ")]),t._v(" "),s("Input",{attrs:{type:"number",disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:e.abidance,callback:function(s){t.$set(e,"abidance",s)},expression:"item.abidance"}}),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                天\n                            ")])],1)]),t._v(" "),s("div",{staticClass:"drug-item-info"},[s("div",{staticClass:"drug-fun"},[s("span",{staticClass:"lititle"},[t._v("\n                                单价：\n                            ")]),t._v(" "),s("Input",{attrs:{type:"number",disabled:""},on:{"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:e.price,callback:function(s){t.$set(e,"price",s)},expression:"item.price"}}),t._v(" "),s("span",{staticClass:"unit"},[t._v("\n                                元\n                            ")])],1)])])])}),0)]),t._v(" "),s("Modal",{attrs:{fullscreen:"",title:"选择药品"},model:{value:t.searchdrugmodal,callback:function(e){t.searchdrugmodal=e},expression:"searchdrugmodal"}},[s("div",{staticClass:"search-box-wrapper"},[s("div",{staticClass:"search-box"},[s("Input",{on:{"on-change":t.dealsearchDrug,"on-blur":function(e){return e.preventDefault(),t.inputLoseFocus(e)}},model:{value:t.drugName,callback:function(e){t.drugName=e},expression:"drugName"}})],1),t._v(" "),void 0!==t.searchdruglist||t.searchdruglist.length>0?s("div",{staticClass:"search-yplist"},t._l(t.searchdruglist,function(e,i){return s("div",{key:i},[s("div",{staticClass:"search-ypnameitem ",on:{click:function(s){return t.adddrug(e)}}},[s("div",{staticClass:"ypname"},[t._v(t._s(e.ypname))]),t._v(" "),s("div",{staticClass:"ypinventory"},[t._v(t._s(e.inventory))])])])}),0):t._e(),t._v(" "),void 0===t.searchdruglist||t.searchdruglist.length<=0?s("div",{staticClass:"search-tip"},[t._v("\n                没有搜索到该药品\n            ")]):t._e()])]),t._v(" "),s("Modal",{attrs:{title:"提示"},on:{"on-ok":t.deletoutsitem},model:{value:t.isshowtip,callback:function(e){t.isshowtip=e},expression:"isshowtip"}},[t._v("\n        请正确填写信息\n    ")]),t._v(" "),s("Modal",{attrs:{title:"提示"},model:{value:t.unselectdrugmodel,callback:function(e){t.unselectdrugmodel=e},expression:"unselectdrugmodel"}},[t._v("\n        请选择药品\n    ")]),t._v(" "),s("Modal",{attrs:{title:"提示"},on:{"on-ok":t.insertprescribe},model:{value:t.isinsertprescribe,callback:function(e){t.isinsertprescribe=e},expression:"isinsertprescribe"}},[t._v("\n        请确认是否提交\n    ")]),t._v(" "),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.isshowloading,expression:"isshowloading"}],staticClass:"loading"})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"title-tip"},[e("span",[this._v("患者姓名:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"title-tip"},[e("span",[this._v("患者卡号:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"title-tip"},[e("span",[this._v("就诊科室:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"title-tip"},[e("span",[this._v("就诊医生:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"title-tip"},[e("span",[this._v("医嘱类别:")])])}]};var o=s("VU/8")(r,a,!1,function(t){s("0kI5")},"data-v-1a4614f7",null);e.default=o.exports}});